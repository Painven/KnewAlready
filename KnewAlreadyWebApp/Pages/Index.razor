@page "/"
@using KnewAlreadyWebApp.Data
@inject KnewAlreadyApiHttpClient apiClient

<PageTitle>Index</PageTitle>

<div class="suggest-action-tool-panel my-2">
    <div class="btn-group" role="group">
        <button class="btn btn-secondary p-2" @onclick="(e => LoadTestData())">
            <span class="oi oi-cloud"></span>
            Обновить
        </button>
        <button class="btn btn-warning p-2" 
            disabled=@(data.Count == 0)
            @onclick="(e => { data.Clear(); StateHasChanged(); } )">
            <span class="oi oi-trash"></span>
            Очистить
        </button>

    </div>
</div>

<h2>Все запросы</h2>
<div class="suggest-action-list">
    @if(data is not null)
    {
        @foreach(var item in data)
        {
            <div class="suggest-action-item">
                <p>Создан: <span>@item.Created</span></p>
                <h3>@item.CategoryName</h3>
                <div class="suggest-action-item-inner">
                    <p>@item.InitiatorUsername</p>
                    <span class=@("fa " + (item.IsCompleted ? "fa-hands-helping completed" : "fa-question"))></span>
                    <p>@item.AcceptorUsername</p>
                </div>
            </div>
        }
    }
    else
    {
        <LoadingSpinner />
    }
</div>


@code {
    List<SuggestActionItem> data = new List<SuggestActionItem>();

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(System.TimeSpan.FromSeconds(2));
        LoadTestData();
    }

    private void LoadTestData()
    {
        var random = new Random();

        var list = Enumerable.Range(0, 25)
        .Select(i => new SuggestActionItem()
            {
                AcceptorUsername = "painven1",
                InitiatorUsername = "painven2",
                CategoryName = "General",
                IsCompleted = random.Next(2) == 0 ? true : false,
                Created = DateTime.Now.AddHours(-i)
            }).ToList();

        data = list;
    }
}